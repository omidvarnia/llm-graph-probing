# Hallucination Detection Pipeline Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   HALLUCINATION DETECTION PIPELINE                          â”‚
â”‚                                                                             â”‚
â”‚  Comprehensive workflow for detecting hallucinations in LLM outputs         â”‚
â”‚  using neural topology analysis and graph probing                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: DATA PREPARATION                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input:   HuggingFace Datasets API                                         â”‚
â”‚           â†“                                                                 â”‚
â”‚  Process: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚           â”‚ Load TruthfulQA Dataset         â”‚                              â”‚
â”‚           â”‚ - Questions                     â”‚                              â”‚
â”‚           â”‚ - True answers (label=1)        â”‚                              â”‚
â”‚           â”‚ - False answers (label=0)       â”‚                              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚           â†“                                                                 â”‚
â”‚  Output:  data/hallucination/truthfulqa-validation.csv                     â”‚
â”‚                                                                             â”‚
â”‚  Example:                                                                   â”‚
â”‚    question_id | question               | answer   | label                 â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚    0           | Capital of France?     | Paris    | 1                     â”‚
â”‚    0           | Capital of France?     | London   | 0                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: COMPUTE NEURAL TOPOLOGY                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input:   truthfulqa-validation.csv + LLM Model                            â”‚
â”‚           â†“                                                                 â”‚
â”‚  Process: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚           â”‚ For each (question, answer) pair:         â”‚                   â”‚
â”‚           â”‚                                            â”‚                   â”‚
â”‚           â”‚ 1. Format prompt with question + answer   â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 2. Run through LLM                         â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 3. Extract hidden states at layer L       â”‚                   â”‚
â”‚           â”‚    Shape: [num_tokens, num_neurons]       â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 4. Compute correlation matrix              â”‚                   â”‚
â”‚           â”‚    Corr[i,j] = correlation(neuron_i,       â”‚                   â”‚
â”‚           â”‚                             neuron_j)      â”‚                   â”‚
â”‚           â”‚    Shape: [num_neurons, num_neurons]      â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 5. Optional: Sparsify (keep top edges)    â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 6. Save as graph                           â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â†“                                                                 â”‚
â”‚  Output:  data/hallucination/<model>/<idx>/                                â”‚
â”‚           â”œâ”€â”€ layer_<N>_corr.npy         (correlation matrix)              â”‚
â”‚           â””â”€â”€ layer_<N>_activation.npy   (raw activations)                 â”‚
â”‚                                                                             â”‚
â”‚  Visualization:                                                             â”‚
â”‚    Correlation Matrix (example):                                           â”‚
â”‚    â”Œ                      â”                                                â”‚
â”‚    â”‚ 1.0  0.8  0.3  0.1   â”‚  Neuron 0                                      â”‚
â”‚    â”‚ 0.8  1.0  0.5  0.2   â”‚  Neuron 1                                      â”‚
â”‚    â”‚ 0.3  0.5  1.0  0.7   â”‚  Neuron 2                                      â”‚
â”‚    â”‚ 0.1  0.2  0.7  1.0   â”‚  Neuron 3                                      â”‚
â”‚    â””                      â”˜                                                â”‚
â”‚      â†‘                                                                      â”‚
â”‚      Neurons 0-1 highly correlated â†’ Strong connection                     â”‚
â”‚      Neurons 0-3 weakly correlated â†’ Weak connection                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: TRAIN HALLUCINATION DETECTION PROBES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input:   Neural topology graphs from Step 2                               â”‚
â”‚           â†“                                                                 â”‚
â”‚  Process: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚           â”‚ 1. Load correlation matrices as graphs     â”‚                   â”‚
â”‚           â”‚    Nodes = Neurons                         â”‚                   â”‚
â”‚           â”‚    Edges = Correlations                    â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 2. Split data:                             â”‚                   â”‚
â”‚           â”‚    - Training set (80%)                    â”‚                   â”‚
â”‚           â”‚    - Test set (20%)                        â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 3. Initialize probe architecture:          â”‚                   â”‚
â”‚           â”‚                                            â”‚                   â”‚
â”‚           â”‚    Option A: GNN (Graph Neural Network)    â”‚                   â”‚
â”‚           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚           â”‚    â”‚ Graph   â”‚â†’ â”‚ GCN     â”‚â†’ â”‚ Softmax â”‚ â”‚                   â”‚
â”‚           â”‚    â”‚ Input   â”‚  â”‚ Layers  â”‚  â”‚ Output  â”‚ â”‚                   â”‚
â”‚           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚
â”‚           â”‚                                            â”‚                   â”‚
â”‚           â”‚    Option B: Linear Probe                  â”‚                   â”‚
â”‚           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                   â”‚
â”‚           â”‚    â”‚ Flatten â”‚â†’ â”‚ Linear  â”‚               â”‚                   â”‚
â”‚           â”‚    â”‚ Matrix  â”‚  â”‚ Layer   â”‚               â”‚                   â”‚
â”‚           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 4. Train to classify:                      â”‚                   â”‚
â”‚           â”‚    Label 0: Hallucination                  â”‚                   â”‚
â”‚           â”‚    Label 1: Truthful                       â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 5. Optimize with cross-entropy loss       â”‚                   â”‚
â”‚           â”‚    Monitor validation performance          â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 6. Early stopping when no improvement     â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 7. Save best model checkpoint              â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â†“                                                                 â”‚
â”‚  Output:  saves/hallucination/<model>/layer_<N>/best_model_*.pth          â”‚
â”‚           runs/ (TensorBoard logs)                                         â”‚
â”‚                                                                             â”‚
â”‚  Training Metrics:                                                          â”‚
â”‚    Epoch  | Train Loss | Val Acc | Val F1                                  â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚    1      | 0.693      | 0.523   | 0.512                                   â”‚
â”‚    10     | 0.512      | 0.687   | 0.671                                   â”‚
â”‚    25     | 0.387      | 0.812   | 0.804                                   â”‚
â”‚    50     | 0.245      | 0.854   | 0.847  â† Best model                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: EVALUATE TRAINED PROBES                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input:   Best model checkpoint + Test data                                â”‚
â”‚           â†“                                                                 â”‚
â”‚  Process: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚           â”‚ 1. Load best model checkpoint              â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 2. Run inference on test set              â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 3. Compute predictions                     â”‚                   â”‚
â”‚           â”‚    â†“                                       â”‚                   â”‚
â”‚           â”‚ 4. Calculate metrics:                      â”‚                   â”‚
â”‚           â”‚    - Accuracy                              â”‚                   â”‚
â”‚           â”‚    - Precision                             â”‚                   â”‚
â”‚           â”‚    - Recall                                â”‚                   â”‚
â”‚           â”‚    - F1 Score                              â”‚                   â”‚
â”‚           â”‚    - Confusion Matrix                      â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â†“                                                                 â”‚
â”‚  Output:  Comprehensive evaluation metrics                                 â”‚
â”‚                                                                             â”‚
â”‚  Example Results:                                                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚    â”‚ Test Metrics:                         â”‚                               â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚                               â”‚
â”‚    â”‚ Accuracy:   85.42%                    â”‚                               â”‚
â”‚    â”‚ Precision:  87.34%                    â”‚                               â”‚
â”‚    â”‚ Recall:     83.12%                    â”‚                               â”‚
â”‚    â”‚ F1 Score:   85.18%                    â”‚                               â”‚
â”‚    â”‚                                       â”‚                               â”‚
â”‚    â”‚ Confusion Matrix:                     â”‚                               â”‚
â”‚    â”‚              Predicted                â”‚                               â”‚
â”‚    â”‚           False    True                â”‚                               â”‚
â”‚    â”‚ Actual  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                               â”‚
â”‚    â”‚ False   â”‚  245  â”‚   32   â”‚           â”‚                               â”‚
â”‚    â”‚ True    â”‚   41  â”‚  203   â”‚           â”‚                               â”‚
â”‚    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                               â”‚
â”‚    â”‚                                       â”‚                               â”‚
â”‚    â”‚ Interpretation:                       â”‚                               â”‚
â”‚    â”‚ - True Positives:  203 (correct true) â”‚                               â”‚
â”‚    â”‚ - True Negatives:  245 (correct false)â”‚                               â”‚
â”‚    â”‚ - False Positives: 32 (false alarm)   â”‚                               â”‚
â”‚    â”‚ - False Negatives: 41 (missed truth)  â”‚                               â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: GRAPH STATISTICS ANALYSIS                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input:   Neural topology data from Step 2                                 â”‚
â”‚           â†“                                                                 â”‚
â”‚  Process: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚           â”‚ For each question:                                 â”‚           â”‚
â”‚           â”‚                                                    â”‚           â”‚
â”‚           â”‚ 1. Load all answer graphs:                        â”‚           â”‚
â”‚           â”‚    - True answer graphs (T1, T2, ...)             â”‚           â”‚
â”‚           â”‚    - False answer graphs (F1, F2, ...)            â”‚           â”‚
â”‚           â”‚    â†“                                               â”‚           â”‚
â”‚           â”‚ 2. Compute intra-correlation:                     â”‚           â”‚
â”‚           â”‚                                                    â”‚           â”‚
â”‚           â”‚    Intra-True:                                     â”‚           â”‚
â”‚           â”‚    â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”                        â”‚           â”‚
â”‚           â”‚    â”‚ T1 â”‚â”€â”€â”‚ T2 â”‚â”€â”€â”‚ T3 â”‚  Cluster?              â”‚           â”‚
â”‚           â”‚    â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜                        â”‚           â”‚
â”‚           â”‚       â†‘       â†‘       â†‘                           â”‚           â”‚
â”‚           â”‚       Correlation among true answers              â”‚           â”‚
â”‚           â”‚                                                    â”‚           â”‚
â”‚           â”‚    Intra-False:                                    â”‚           â”‚
â”‚           â”‚    â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”                        â”‚           â”‚
â”‚           â”‚    â”‚ F1 â”‚Â·Â·â”‚ F2 â”‚Â·Â·â”‚ F3 â”‚  Scattered?            â”‚           â”‚
â”‚           â”‚    â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜                        â”‚           â”‚
â”‚           â”‚       â†‘       â†‘       â†‘                           â”‚           â”‚
â”‚           â”‚       Correlation among false answers             â”‚           â”‚
â”‚           â”‚    â†“                                               â”‚           â”‚
â”‚           â”‚ 3. Compute inter-correlation:                     â”‚           â”‚
â”‚           â”‚                                                    â”‚           â”‚
â”‚           â”‚    â”Œâ”€â”€â”€â”€â”                                          â”‚           â”‚
â”‚           â”‚    â”‚ T1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚           â”‚
â”‚           â”‚    â””â”€â”€â”€â”€â”˜        â”‚                                â”‚           â”‚
â”‚           â”‚                  Ã—  Low correlation?              â”‚           â”‚
â”‚           â”‚    â”Œâ”€â”€â”€â”€â”        â”‚                                â”‚           â”‚
â”‚           â”‚    â”‚ F1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚           â”‚
â”‚           â”‚    â””â”€â”€â”€â”€â”˜                                          â”‚           â”‚
â”‚           â”‚       â†‘                                            â”‚           â”‚
â”‚           â”‚       Correlation between true and false           â”‚           â”‚
â”‚           â”‚    â†“                                               â”‚           â”‚
â”‚           â”‚ 4. Statistical analysis:                          â”‚           â”‚
â”‚           â”‚    - Mean correlations                            â”‚           â”‚
â”‚           â”‚    - Standard deviations                          â”‚           â”‚
â”‚           â”‚    - Significance tests                           â”‚           â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â†“                                                                 â”‚
â”‚  Output:  Statistical summary and per-question metrics                     â”‚
â”‚                                                                             â”‚
â”‚  Example Results:                                                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚    â”‚ Graph Topology Analysis:                         â”‚                    â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚                    â”‚
â”‚    â”‚                                                   â”‚                    â”‚
â”‚    â”‚ Intra-True Correlation:   0.742 Â± 0.083         â”‚                    â”‚
â”‚    â”‚ Intra-False Correlation:  0.523 Â± 0.124         â”‚                    â”‚
â”‚    â”‚ Inter-Correlation:        0.312 Â± 0.095         â”‚                    â”‚
â”‚    â”‚                                                   â”‚                    â”‚
â”‚    â”‚ Interpretation:                                  â”‚                    â”‚
â”‚    â”‚ âœ“ High intra-true: Truthful answers have        â”‚                    â”‚
â”‚    â”‚   consistent neural patterns                     â”‚                    â”‚
â”‚    â”‚                                                   â”‚                    â”‚
â”‚    â”‚ âœ“ Medium intra-false: Hallucinations vary       â”‚                    â”‚
â”‚    â”‚   in their neural signatures                     â”‚                    â”‚
â”‚    â”‚                                                   â”‚                    â”‚
â”‚    â”‚ âœ“ Low inter-correlation: Clear distinction      â”‚                    â”‚
â”‚    â”‚   between true and false neural patterns        â”‚                    â”‚
â”‚    â”‚                                                   â”‚                    â”‚
â”‚    â”‚ Conclusion: Neural topology provides strong     â”‚                    â”‚
â”‚    â”‚ signal for hallucination detection!             â”‚                    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FINAL OUTPUT SUMMARY                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚ ğŸ“ Directory Structure:                                                     â”‚
â”‚                                                                             â”‚
â”‚  llm-graph-probing/                                                         â”‚
â”‚  â”œâ”€â”€ data/hallucination/                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ truthfulqa-validation.csv         â† TruthfulQA dataset            â”‚
â”‚  â”‚   â””â”€â”€ qwen2.5-0.5b/                      â† Neural topology              â”‚
â”‚  â”‚       â”œâ”€â”€ 0/layer_12_corr.npy                                           â”‚
â”‚  â”‚       â”œâ”€â”€ 1/layer_12_corr.npy                                           â”‚
â”‚  â”‚       â””â”€â”€ ...                                                            â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ saves/hallucination/                                                   â”‚
â”‚  â”‚   â””â”€â”€ qwen2.5-0.5b/layer_12/             â† Trained models               â”‚
â”‚  â”‚       â””â”€â”€ best_model_*.pth                                              â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ runs/                                   â† TensorBoard logs             â”‚
â”‚  â”‚   â””â”€â”€ ...                                                                â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â””â”€â”€ hallucination_pipeline.log             â† Execution log                â”‚
â”‚                                                                             â”‚
â”‚ ğŸ“Š Key Insights:                                                            â”‚
â”‚  â€¢ Hallucinations have distinct neural topology                            â”‚
â”‚  â€¢ Correlation-based probes achieve 80-90% accuracy                        â”‚
â”‚  â€¢ Graph structure matters for detection                                   â”‚
â”‚  â€¢ Different layers show different sensitivity                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USAGE QUICK REFERENCE                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Run complete pipeline:                                                     â”‚
â”‚    python hallucination_pipeline.py                                        â”‚
â”‚                                                                             â”‚
â”‚  Run specific step:                                                         â”‚
â”‚    python hallucination_pipeline.py --step <1-5>                           â”‚
â”‚                                                                             â”‚
â”‚  Custom configuration:                                                      â”‚
â”‚    python hallucination_pipeline.py \                                      â”‚
â”‚      --llm_model_name pythia-70m \                                         â”‚
â”‚      --llm_layer 5 \                                                       â”‚
â”‚      --probe_input corr \                                                  â”‚
â”‚      --num_layers 2                                                        â”‚
â”‚                                                                             â”‚
â”‚  Using shell script:                                                        â”‚
â”‚    ./run_hallucination_pipeline.sh quick    # Quick test                  â”‚
â”‚    ./run_hallucination_pipeline.sh default  # Default run                 â”‚
â”‚    ./run_hallucination_pipeline.sh sparse   # Sparse graphs               â”‚
â”‚                                                                             â”‚
â”‚  For more details, see:                                                     â”‚
â”‚    â€¢ QUICK_REFERENCE.md                                                    â”‚
â”‚    â€¢ HALLUCINATION_PIPELINE_GUIDE.md                                       â”‚
â”‚    â€¢ IMPLEMENTATION_SUMMARY.md                                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
